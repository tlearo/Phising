<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Choose puzzles, track progress, and unlock the vault in Cyber Escape Rooms." />
  <link rel="icon" href="assets/favicon.png" type="image/png" />

  <!-- Tight CSP (local assets only) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self';
                 object-src 'none';
                 base-uri 'self';
                 frame-ancestors 'none'">

  <title>Cyber Escape Rooms ‚Äî Game</title>

  <!-- External files only -->
  <link rel="stylesheet" href="css/styles.css" />
  <script src="js/accessibility.js" defer></script>
  <script src="js/utils.js" defer></script>
  <script src="js/state-sync.js" defer></script>
  <script src="js/session.js" defer></script>
  <script src="js/vault.js" defer></script>
  <script src="js/game.js" defer></script>
</head>

<body data-session="team">
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Global Header -->
  <header class="site-header site-header--bar" aria-label="Global">
    <div class="site-header__inner">
      <div class="header-left">
        <button class="nav-btn ghost nav-btn--back" type="button" data-back="index.html" data-tooltip="Back to previous page">
          <span aria-hidden="true">‚Üê</span>
          <span>Back</span>
        </button>
        <a class="brand" href="game.html">
          <img src="assets/logo.png" alt="" class="logo" />
          <span class="brand-copy">
            <span class="brand-name">Cyber Escape Rooms</span>
            <span class="brand-tagline">Team-based security missions</span>
          </span>
        </a>
      </div>

      <div class="header-actions">
        <nav class="main-nav" aria-label="Primary">
          <a class="nav-link" href="game.html">Mission Hub</a>
          <a class="nav-link" href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
        </nav>
        <div class="vault-status" id="vaultStatus" role="status" aria-live="polite" data-visible="team">
          <span class="vault-status__label">Vault</span>
          <ol class="vault-status__digits">
            <li data-vault-key="phishing">‚Ä¢</li>
            <li data-vault-key="encryption">‚Ä¢</li>
            <li data-vault-key="password">‚Ä¢</li>
            <li data-vault-key="essential">‚Ä¢</li>
            <li data-vault-key="binary">‚Ä¢</li>
          </ol>
          <span class="vault-status__count">0/5</span>
        </div>
        <button class="nav-btn alert nav-btn--logout" type="button" data-action="logout">Logout</button>
      </div>
    </div>
  </header>

  <main class="game-wrapper container" id="main" role="main" tabindex="-1">
    <header class="game-header">
      <h1 class="glow">Cyber Escape Rooms</h1>
      <p class="game-header__welcome">Welcome, <span id="teamName" data-user-name>TEAM</span>!</p>
    </header>

    <section class="intro-banner mt-2" aria-labelledby="missionBriefingHeading">
      <h2 id="missionBriefingHeading">Mission Briefing</h2>
      <p>You are racing rival crews to crack the vault. Solve each puzzle in order, bank the digit it reveals, and keep your score high‚Äîevery hint or incorrect move costs precious points.</p>
      <ol>
        <li><strong>Step 1:</strong> Start with the highlighted puzzle below. It represents your next objective.</li>
        <li><strong>Step 2:</strong> Note the digit you earn and enter it on the vault lock to the right.</li>
        <li><strong>Step 3:</strong> Repeat until all five digits are filled, then unlock the chest to win.</li>
      </ol>
      <p id="scoreExplainer">Teams begin with a full score. Staying accurate and avoiding unnecessary hints keeps your total at the top of the leaderboard.</p>
    </section>

    <!-- Mission layout -->
    <section class="dashboard-grid mt-2" aria-label="Cyber mission layout">
      <section class="card mission-card" aria-labelledby="missionHeading">
        <header class="mission-card__header">
          <h2 id="missionHeading">Mission Hub</h2>
          <p class="muted">Launch puzzles, monitor progress, and stay ahead of rival crews.</p>
        </header>

        <div class="mission-brief" aria-live="polite">
          <p class="mission-brief__title">Current Objective</p>
          <p class="mission-brief__next">
            <span>Next up:</span>
            <span class="tag" id="nextPuzzleTag">Loading‚Ä¶</span>
            <span id="nextPuzzleHint">Complete the highlighted puzzle to progress.</span>
          </p>
          <a class="btn mt-1" href="phishing.html" id="startChallengesBtn">Start challenges</a>
        </div>

        <section class="status-hud mt-2" aria-label="Team status">
          <div class="points-box">
            <p class="points-box__label">Team points</p>
            <p class="points-box__value" id="scoreTotal">000</p>
            <button class="btn ghost sm" type="button" id="scoreLogBtn">View log</button>
            <p class="points-box__delta" id="missionPointsDelta" aria-live="polite"></p>
          </div>
          <div class="progress-mini">
            <p class="progress-mini__label">Overall progress</p>
            <div class="progress-mini__track">
              <div class="progress-mini__fill" id="missionProgressFill"></div>
            </div>
            <p class="progress-mini__text" id="progressStatus">0/5 puzzles completed</p>
          </div>
        </section>

        <section class="player-alias card mt-2" aria-label="Player name entry">
          <div>
            <label class="player-alias__label" for="playerAliasInput">Player name (optional)</label>
            <input id="playerAliasInput" type="text" maxlength="40" placeholder="Enter your name" data-sanitize="text" autocomplete="off" />
          </div>
          <p class="player-alias__hint muted">Displayed separately from the team login. Leave blank if you prefer to stay anonymous.</p>
          <p class="player-alias__display">Showing as: <strong id="playerAliasDisplay">‚Äî</strong></p>
        </section>

        <div id="scoreLog" class="score-log" hidden></div>

        <div class="mission-tracker mt-2">
          <ul class="mission-tracker__list" id="missionTrackerList">
            <li>
              <a class="mission-tracker__item" href="phishing.html" data-puzzle="phishing">
                <div class="mission-tracker__header">
                  <span class="mission-tracker__name">üêü Phishing Spotter</span>
                  <span class="mission-tracker__progress">0%</span>
                </div>
                <div class="mission-tracker__bar"><span class="mission-tracker__fill"></span></div>
                <p class="mission-tracker__hint">Spot phishing clues and earn the first digit.</p>
              </a>
            </li>
            <li>
              <a class="mission-tracker__item" href="password.html" data-puzzle="password">
                <div class="mission-tracker__header">
                  <span class="mission-tracker__name">üîê Password Puzzle</span>
                  <span class="mission-tracker__progress">0%</span>
                </div>
                <div class="mission-tracker__bar"><span class="mission-tracker__fill"></span></div>
                <p class="mission-tracker__hint">Crack the weak password to reveal digit two.</p>
              </a>
            </li>
            <li>
              <a class="mission-tracker__item" href="encryption.html" data-puzzle="encryption">
                <div class="mission-tracker__header">
                  <span class="mission-tracker__name">üåÄ Encryption</span>
                  <span class="mission-tracker__progress">0%</span>
                </div>
                <div class="mission-tracker__bar"><span class="mission-tracker__fill"></span></div>
                <p class="mission-tracker__hint">Dial in the Caesar shift to learn digit three.</p>
              </a>
            </li>
            <li>
              <a class="mission-tracker__item" href="essential.html" data-puzzle="essential">
                <div class="mission-tracker__header">
                  <span class="mission-tracker__name">üõ° Essential Eight</span>
                  <span class="mission-tracker__progress">0%</span>
                </div>
                <div class="mission-tracker__bar"><span class="mission-tracker__fill"></span></div>
                <p class="mission-tracker__hint">Match the defensive controls for digit four.</p>
              </a>
            </li>
            <li>
              <a class="mission-tracker__item" href="binary.html" data-puzzle="binary">
                <div class="mission-tracker__header">
                  <span class="mission-tracker__name">üßÆ Binary Lab</span>
                  <span class="mission-tracker__progress">0%</span>
                </div>
                <div class="mission-tracker__bar"><span class="mission-tracker__fill"></span></div>
                <p class="mission-tracker__hint">Finish the binary math to capture the final digit.</p>
              </a>
            </li>
          </ul>
        </div>

        <section class="endless-callout" id="endlessCallout" aria-hidden="true" hidden>
          <h2>Bonus: Endless Challenge</h2>
          <p class="muted">Already cracked the vault? Keep the crew sharp with an optional quickfire quiz. Scores live on a separate leaderboard so everyone can compete for bragging rights.</p>
          <a class="btn ghost" href="endless.html">Launch Endless Challenge</a>
        </section>

        <section class="bonus-callout" id="firewallBonusCallout" aria-hidden="true" hidden>
          <h2>Bonus: Firewall Configuration Puzzle</h2>
          <p class="muted">If the vault is open and you still have time, fine-tune the perimeter rules to block attackers without disrupting the business.</p>
          <a class="btn ghost" href="firewall.html">Launch Firewall Bonus</a>
        </section>

        <footer class="mission-card__footer">
          <button class="btn ghost" type="button" data-back="index.html">Back</button>
          <button class="btn" type="button" data-action="logout">Logout</button>
        </footer>
      </section>

      <section class="card chest-section">
        <h2>Vault Lock</h2>
        <p class="mt-1" style="color:var(--muted)">Gather each digit from the puzzles and unlock the vault.</p>

        <div class="vault-box mt-2">
          <div id="vaultChest" class="chest" aria-live="polite">
            <div class="chest-lid"></div>
            <div class="chest-body">
              <button class="lock-button" type="button" id="lockOpenBtn" title="Open vault (when code is correct)">üîí</button>
            </div>
          </div>

          <div class="lock-panel mt-2">
            <div class="lock-box">
              <input class="lock-digit" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit 1 (Phishing)">
              <input class="lock-digit" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit 2 (Encryption)">
              <input class="lock-digit" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit 3 (Password)">
              <input class="lock-digit" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit 4 (Essential)">
              <input class="lock-digit" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="Digit 5 (Binary)">
            </div>

            <div class="lock-actions mt-2">
              <button class="btn" id="unlockBtn" type="button" data-tooltip="Check the vault code">Unlock</button>
              <button class="btn ghost" id="clearCodeBtn" type="button" data-tooltip="Clear entered digits">Clear</button>
            </div>

            <p id="lockFeedback" class="mt-2" aria-live="polite"></p>
          </div>

          <details class="mt-2 vault-hint">
            <summary>How do we get the 5 digits?</summary>
            <ol>
              <li><strong>Phishing Spotter</strong> ‚Äî number of phishing emails in the set.</li>
              <li><strong>Encryption</strong> ‚Äî the Caesar wheel shift that reveals the plaintext.</li>
              <li><strong>Password Puzzle</strong> ‚Äî the rounded minutes to crack the winning password.</li>
              <li><strong>Essential Eight</strong> ‚Äî there are 8 essential mitigation strategies.</li>
              <li><strong>Binary Lab</strong> ‚Äî the ones digit of your binary multiplication result.</li>
            </ol>
          </details>
        </div>
      </section>

    </section>

    <footer class="mt-3">
      <p style="color:var(--muted)">Tip: finish all five puzzles to learn the full 5-digit code.</p>
    </footer>
  </main>

  <!-- Global Footer -->
  <footer class="site-footer header-bleed">
    <div class="footer-inner">
      <nav class="footer-nav" aria-label="Footer">
        <a href="index.html">Home</a>
        <span aria-hidden="true">‚Ä¢</span>
        <a href="game.html" aria-current="page">Mission Hub</a>
        <span aria-hidden="true">‚Ä¢</span>
        <a href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
      </nav>
      <p class="footer-note">Unlock the vault by cracking five cyber puzzles as a team.</p>
      <p class="footer-copy"><small>&copy; 2025 Cyber Escape Rooms</small></p>
    </div>
  </footer>
</body>
</html>
