<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Spot phishing indicators by marking the risky parts of real-looking emails." />
  <link rel="icon" href="assets/favicon.png" type="image/png" />

  <!-- Tight CSP (local assets only) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self';
                 object-src 'none';
                 base-uri 'self';
                 frame-ancestors 'none'">

  <title>Cyber Escape Rooms — Phishing Spotter</title>

  <!-- External files only -->
  <link rel="stylesheet" href="css/styles.css" />
  <script src="js/accessibility.js" defer></script>
  <script src="js/utils.js" defer></script>
  <script src="js/state-sync.js" defer></script>
  <script src="js/session.js" defer></script>
  <script src="js/vault.js" defer></script>
  <script src="js/onboarding.js" defer></script>
  <script src="js/phishing.js" defer></script>
</head>

<body data-session="team">
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Global Header -->
  <header class="site-header site-header--bar" aria-label="Global">
    <div class="site-header__inner">
      <div class="header-left">
        <button class="nav-btn ghost nav-btn--back" type="button" data-back="game.html" data-tooltip="Back to previous page">
          <span aria-hidden="true">←</span>
          <span>Back</span>
        </button>
        <a class="brand" href="game.html">
          <img src="assets/logo.png" alt="" class="logo" />
          <span class="brand-copy">
            <span class="brand-name">Cyber Escape Rooms</span>
            <span class="brand-tagline">Team-based security missions</span>
          </span>
        </a>
      </div>

      <div class="header-actions">
        <nav class="main-nav" aria-label="Primary">
          <a class="nav-link" href="game.html">Mission Hub</a>
          <a class="nav-link" href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
        </nav>
        <div class="vault-status" id="vaultStatus" role="status" aria-live="polite" data-visible="team">
          <span class="vault-status__label">Vault</span>
          <ol class="vault-status__digits">
            <li data-vault-key="phishing">•</li>
            <li data-vault-key="encryption">•</li>
            <li data-vault-key="password">•</li>
            <li data-vault-key="essential">•</li>
            <li data-vault-key="binary">•</li>
          </ol>
          <span class="vault-status__count">0/5</span>
        </div>
        <button class="nav-btn alert nav-btn--logout" type="button" data-action="logout">Logout</button>
      </div>
    </div>
  </header>

  <main class="container-xl" id="main" role="main" tabindex="-1">
    <header class="game-header">
      <h1 class="glow">Phishing Spotter</h1>
      <p class="mt-1" style="color:var(--muted)">
        Mark the risky parts of the email (domains, grammar, urgency, mismatched branding…). Find enough indicators to earn your digit.
      </p>
      <div class="puzzle-actions mt-1">
        <button class="btn ghost sm onboard-trigger" type="button" data-onboard="onboard-phishing">How to play</button>
      </div>
    </header>

    <section class="intro-banner mt-2" aria-labelledby="phishingBriefHeading">
      <h2 id="phishingBriefHeading">Points & objectives</h2>
      <p>Each correct highlight and classification keeps your score intact. Missing obvious clues, clearing highlights without reason, or guessing the verdict too early chips away at your total.</p>
      <ul>
        <li>Capture at least three hotspots per message to stay on pace for full credit.</li>
        <li>Hints cost points—use them only when the trail goes cold.</li>
        <li>Record the digit once <strong>Submit Highlights</strong> gives you the all-clear.</li>
        <li>Need a breather? Use Save/Load to preserve your work without losing points.</li>
      </ul>
      <div class="vault-callout" role="status">
        <span class="tag">Vault digit</span>
        <p><strong id="phishVaultValue">—</strong> phishing emails in this gallery. Mark them correctly to unlock digit one.</p>
      </div>
    </section>

    <section class="status-hud" aria-label="Team status">
      <div class="points-box">
        <p class="points-box__label">Team points</p>
        <p class="points-box__value" id="phishPointsTotal">000</p>
        <p class="points-box__delta" id="phishPointsDelta" aria-live="polite"></p>
      </div>
      <div class="progress-mini">
        <p class="progress-mini__label">Puzzle progress</p>
        <div class="progress-mini__track">
          <div class="progress-mini__fill" id="phishProgressFill"></div>
        </div>
        <p class="progress-mini__text" id="phishProgressText">0% complete</p>
      </div>
    </section>

    <section class="card instructions-card mt-2" aria-labelledby="missionHeading">
      <div class="instructions-grid">
        <div>
          <h2 id="missionHeading">Your mission</h2>
          <ol class="instructions-list">
            <li>Study each email example. Switch slides with the arrows beside the canvas.</li>
            <li>Use the brush tool to circle suspicious clues. Aim to highlight at least three hotspots.</li>
            <li>Submit your highlights, then decide if the email is phishing or legitimate.</li>
          </ol>
        </div>
      </div>
    </section>

    <aside class="card tip-card mt-2" aria-labelledby="phishTipHeading">
      <h2 id="phishTipHeading">Mission tip</h2>
      <p class="muted">Circle only the precise clue (sender, CTA, wording). Broad scribbles cost points and no longer count as valid highlights.</p>
    </aside>

    <!-- Layout: left tools, right stage -->
    <section class="main-layout mt-2" id="phishWorkspace">
      <!-- LEFT: toolbox -->
      <aside class="card phish-sidebar" aria-label="Mission steps">
        <section class="phish-step" data-step="1">
          <div class="phish-step__heading">
            <span class="step-pill">Step 1</span>
            <h3>Classify first</h3>
          </div>
          <p class="muted">Choose a verdict before highlighting. Only phishing examples accept highlights.</p>
          <div class="classification-buttons" id="classificationBlock" aria-label="Email classification actions">
            <button class="btn cta-btn warn" id="markPhish" type="button" aria-pressed="false">This is Phishing</button>
            <button class="btn cta-btn ghost" id="markLegit" type="button" aria-pressed="false">Looks Legit</button>
          </div>
        </section>

        <section class="phish-step" data-step="2">
          <div class="phish-step__heading">
            <span class="step-pill">Step 2</span>
            <h3>Mark the clues</h3>
          </div>
          <p class="muted">Use tight circles over sender details, URLs, grammar errors, or urgency cues.</p>
          <div class="tool-stack">
            <div class="tool-row">
              <button class="btn tool-btn" data-tool="brush" onclick="setTool('brush')" aria-pressed="true">Brush</button>
              <button class="btn ghost tool-btn" data-tool="eraser" onclick="setTool('eraser')">Eraser</button>
            </div>
            <div class="field mt-2">
              <label for="brushSize">Brush size</label>
              <input id="brushSize" type="range" min="2" max="24" value="8" />
            </div>
            <div class="flex mt-2" style="gap:.5rem; flex-wrap:wrap;">
              <button class="btn warn" id="clearBtn" type="button" data-tooltip="Clear current highlights">Clear</button>
              <button class="btn ghost" id="phishHintBtn" type="button">Hint (−5 pts)</button>
            </div>
            <p id="phishHintText" class="hint-callout" hidden>
              Scan the sender address, call-to-action URL, and urgency cues first—phishers often betray themselves there.
            </p>
          </div>
        </section>

        <section class="phish-step" data-step="3">
          <div class="phish-step__heading">
            <span class="step-pill">Step 3</span>
            <h3>Submit & advance</h3>
          </div>
          <p class="muted">Once three hotspots glow green, press <strong>Submit Highlights</strong> under the canvas to lock the slide. Autosave runs after every stroke.</p>
          <p class="autosave-status" id="autosaveStatus" aria-live="polite">Autosave ready.</p>
        </section>

        <section class="phish-step phish-step--examples">
          <div class="phish-step__heading">
            <span class="step-pill">Gallery</span>
            <h3>Email examples</h3>
          </div>
          <nav class="thumb-nav mt-1" aria-label="Examples">
            <ul class="link-list">
              <li><a href="phishing.html?img=Picture1.png">Apple – “sound played”</a></li>
              <li><a href="phishing.html?img=Picture2.png">iCloud – “storage full”</a></li>
              <li><a href="phishing.html?img=Picture3.png">Amazon – “order confirmation”</a></li>
              <li><a href="phishing.html?img=Picture4.png">SharePoint – “file shared”</a></li>
            </ul>
          </nav>
          <p class="mt-2" id="vulnerabilityCount" aria-live="polite">You marked 0 out of 5 vulnerabilities.</p>
          <div class="mt-2">
            <a href="game.html" class="btn ghost">Back to Vault</a>
            <a href="index.html" class="btn">Home</a>
          </div>
        </section>
      </aside>

      <!-- RIGHT: image stage -->
      <section class="card" aria-label="Email example">
        <div class="canvas-header">
          <div>
            <h2>Canvas</h2>
            <p class="muted">Review each example and highlight suspicious details before submitting.</p>
          </div>
          <div class="canvas-actions">
            <button class="btn ghost sm" id="phishZoomOutBtn" type="button" data-tooltip="Zoom out">−</button>
            <button class="btn ghost sm" id="phishZoomInBtn" type="button" data-tooltip="Zoom in">+</button>
            <button class="btn ghost sm" id="phishFullscreenBtn" type="button" data-tooltip="Toggle fullscreen view">Fullscreen</button>
          </div>
        </div>

        <div class="canvas-carousel mt-1">
          <button class="carousel-arrow" id="prevImg" type="button" aria-label="Previous email example">&#10094;</button>

          <div class="image-container">
            <div id="imageStage" class="image-stage">
              <div class="example-banner" id="exampleBanner" aria-live="polite">Example 1 of 4</div>
              <img id="phishingImage"
                   src="assets/Picture1.png"
                   alt="Email screenshot for phishing analysis"
                   referrerpolicy="no-referrer" />

              <canvas id="drawCanvas" width="800" height="600"></canvas>
            </div>
          </div>

          <button class="carousel-arrow" id="nextImg" type="button" aria-label="Next email example">&#10095;</button>
        </div>

        <div class="carousel-dots" id="exampleDots" aria-label="Email example navigation" role="tablist"></div>
        <p id="slideStatus" class="muted text-center" aria-live="polite">Example 1 of 4</p>
        <p id="vulnerabilityCountStage" class="muted stage-vuln" aria-live="polite"></p>

        <div id="feedbackPanel" class="mt-2">
          <div class="feedback-actions">
            <button id="submitButton" class="btn primary" type="button" data-tooltip="Submit highlights for review">Submit Highlights</button>
            <p class="cta-hint">Steps 1 &amp; 2 must be complete before submitting.</p>
          </div>
          <p id="phishingFeedback" class="status-message mt-1" aria-live="polite"></p>
        </div>
      </section>
    </section>

    <section class="card resources-card mt-2" aria-labelledby="phishResourcesHeading">
      <h2 id="phishResourcesHeading">Further learning</h2>
      <ul>
        <li><a href="https://www.cyber.gov.au/resources-business-and-government/online-scams/avoiding-phishing-scams" target="_blank" rel="noopener">ACSC — Avoiding phishing scams</a></li>
        <li><a href="https://www.cisa.gov/news-events/news/stop-think-connect-avoid-phishing-attacks" target="_blank" rel="noopener">CISA — Avoid phishing attacks</a></li>
        <li><a href="https://www.proofpoint.com/us/threat-reference/phishing" target="_blank" rel="noopener">Proofpoint threat reference</a></li>
      </ul>
    </section>

    <nav class="challenge-nav" aria-label="Puzzle navigation">
      <a class="btn ghost" href="game.html">&larr; Mission Hub</a>
      <a class="btn" href="password.html">Next: Password Puzzle &rarr;</a>
    </nav>

    <footer class="mt-3">
      <p style="color:var(--muted)">Tip: check sender domain, links, grammar/formatting, urgency, and mismatched branding.</p>
    </footer>
  </main>

  <div class="onboard" id="onboard-phishing" hidden data-onboard-key="phishing" data-onboard-auto="true" aria-labelledby="onboardPhishingTitle">
    <div class="onboard__backdrop" data-onboard-close></div>
    <div class="onboard__dialog">
      <button class="onboard__close" type="button" aria-label="Close tutorial" data-onboard-close>&times;</button>
      <h2 id="onboardPhishingTitle" data-onboard-focus>Phishing Spotter — Quick Guide</h2>
      <p>Earn vault digit one by clearing each email example with precise highlights.</p>
      <ol class="onboard__list">
        <li>Highlight at least three hotspots on every email before you submit anything.</li>
        <li>Choose whether the example is phishing or legitimate, then press Submit Highlights to lock that slide.</li>
        <li>Work through all four examples; the number of true phishing emails becomes your vault digit.</li>
      </ol>
    </div>
  </div>

  <!-- Global Footer -->
  <footer class="site-footer header-bleed">
    <div class="footer-inner">
      <nav class="footer-nav" aria-label="Footer">
        <a href="index.html">Home</a>
        <span aria-hidden="true">•</span>
        <a href="game.html">Mission Hub</a>
        <span aria-hidden="true">•</span>
        <a href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
      </nav>
      <p class="footer-note">Spot every phishing tell to earn the first vault digit.</p>
      <p class="footer-copy"><small>&copy; 2025 Cyber Escape Rooms</small></p>
    </div>
  </footer>

  <!-- Hotspot map (percentages) for strict marking. Inert JSON. -->
  <script type="application/json" id="phishingHotspots">
  {
    "Picture1.png": [
      { "xPct": 0.16, "yPct": 0.17, "label": "Sender address (lookalike domain appl3.co)" },
      { "xPct": 0.08, "yPct": 0.14, "label": "Avatar / sender details panel (generic/unverified)" },
      { "xPct": 0.50, "yPct": 0.44, "label": "Main body / time-callout area (suspicious wording/placement)" }
    ],
    "Picture2.png": [
      { "xPct": 0.18, "yPct": 0.18, "label": "Sender domain (icloudsecure.co) — domain mismatch" },
      { "xPct": 0.38, "yPct": 0.36, "label": "Grammar & phrasing errors in body (poor English)" },
      { "xPct": 0.36, "yPct": 0.46, "label": "Urgent / scare wording (storage full message)" }
    ],
    "Picture3.png": [
      { "xPct": 0.18, "yPct": 0.18, "label": "Display name / sender area (verify domain)" },
      { "xPct": 0.46, "yPct": 0.30, "label": "Order details / order number block" },
      { "xPct": 0.45, "yPct": 0.44, "label": "Primary CTA / View or manage order region" }
    ],
    "Picture4.png": [
      { "xPct": 0.18, "yPct": 0.18, "label": "Sender domain (sharep0int.com with zero) — look-alike" },
      { "xPct": 0.48, "yPct": 0.44, "label": "Document title / file area (targets financial / high-stress content)" }
    ]
  }
  </script>

  <!-- Fallback: set image from query string (?img=Picture2.png). -->
  <script>
    (function () {
      try {
        const params = new URLSearchParams(location.search);
        const imgName = params.get('img');
        if (imgName) {
          const el = document.getElementById('phishingImage');
          if (el) el.src = 'assets/' + imgName;
        }
      } catch (_) {}
    })();
  </script>
</body>
</html>
