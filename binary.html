<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Work through XOR logic and binary multiplication to earn your vault digit in Cyber Escape Rooms." />
  <link rel="icon" href="assets/favicon.png" type="image/png" />

  <!-- Tight CSP (local assets only) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self';
                 object-src 'none';
                 base-uri 'self'">

  <title>Cyber Escape Rooms — Binary Lab</title>

  <!-- External files only -->
  <link rel="stylesheet" href="css/styles.css" />
  <script src="js/accessibility.js" defer></script>
  <script src="js/utils.js" defer></script>
  <script src="js/state-sync.js" defer></script>
  <script src="js/session.js" defer></script>
  <script src="js/vault.js" defer></script>
  <script src="js/onboarding.js" defer></script>
  <script src="js/binary.js" defer></script>
</head>

<body data-session="team">
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Global Header -->
  <header class="site-header site-header--bar" aria-label="Global">
    <div class="site-header__inner">
      <div class="header-left">
        <button class="nav-btn ghost nav-btn--back" type="button" data-back="game.html" data-tooltip="Back to previous page">
          <span aria-hidden="true">←</span>
          <span>Back</span>
        </button>
        <a class="brand" href="game.html">
          <img src="assets/logo.png" alt="" class="logo" />
          <span class="brand-copy">
            <span class="brand-name">Cyber Escape Rooms</span>
            <span class="brand-tagline">Team-based security missions</span>
          </span>
        </a>
      </div>

      <div class="header-actions">
        <nav class="main-nav" aria-label="Primary">
          <a class="nav-link" href="game.html">Mission Hub</a>
        </nav>
        <a class="nav-btn nav-btn--next" href="game.html" aria-label="Return to Mission Hub">
          Finish<span aria-hidden="true">→</span>
        </a>
        <div class="vault-status" id="vaultStatus" role="status" aria-live="polite" data-visible="team">
          <span class="vault-status__label">Vault</span>
          <ol class="vault-status__digits">
            <li data-vault-key="phishing">•</li>
            <li data-vault-key="encryption">•</li>
            <li data-vault-key="password">•</li>
            <li data-vault-key="essential">•</li>
            <li data-vault-key="binary">•</li>
          </ol>
          <span class="vault-status__count">0/5</span>
        </div>
        <button class="nav-btn alert nav-btn--logout" type="button" data-action="logout">Logout</button>
      </div>
    </div>
  </header>

  <main class="container" id="main" role="main" tabindex="-1">
    <header class="game-header">
      <h1 class="glow">Binary Operations Lab</h1>
      <p class="mt-1" style="color:var(--muted)">Compare two six-bit binaries with XOR and capture the vault digit from the decimal result.</p>
      <div class="puzzle-actions mt-1">
        <button class="btn ghost sm onboard-trigger" type="button" data-onboard="onboard-binary">How to play</button>
      </div>
    </header>

    <section class="intro-banner points-card mt-2" aria-labelledby="binaryPointsHeading">
      <details class="points-panel" open>
        <summary id="binaryPointsHeading">Points intel</summary>
        <p>Binary puzzles reward careful arithmetic. Confirm each column before typing and the points stay intact; guesswork leads to rechecks and deductions.</p>
        <ul>
          <li>The XOR row’s decimal sum becomes your vault digit—only submit once every pill shows complete.</li>
          <li>Hints cost 5 points and highlight the rule rather than the answer.</li>
          <li>Use scratch space or the helper table before entering final decimals to avoid penalty resets.</li>
        </ul>
      </details>
      <div class="vault-callout" role="status">
        <span class="tag">Vault digit</span>
        <p>Record the decimal XOR result. When you finish the table, capture <strong id="binaryVaultDigit">—</strong>.</p>
      </div>
    </section>

    <aside class="card tip-card mt-2" aria-labelledby="binaryTipHeading">
      <h2 id="binaryTipHeading">Mission tip</h2>
      <p class="muted">Use the table: every green column adds to the total, grey columns drop out. Sum Binary A, sum Binary B, then compute the XOR digit.</p>
    </aside>

    <section class="status-hud" aria-label="Team status">
      <div class="points-box">
        <p class="points-box__label">Team points</p>
        <p class="points-box__value" id="binaryPointsTotal">000</p>
        <p class="points-box__delta" id="binaryPointsDelta" aria-live="polite"></p>
      </div>
      <div class="progress-mini">
        <p class="progress-mini__label">Puzzle progress</p>
        <div class="progress-mini__track">
          <div class="progress-mini__fill" id="binaryProgressFill"></div>
        </div>
        <p class="progress-mini__text" id="binaryProgressText">0% complete</p>
      </div>
    </section>

    <section class="binary-layout mt-2">
      <section class="card binary-challenge" aria-labelledby="binaryChallengeHeading">
        <h2 id="binaryChallengeHeading">Compute &amp; Combine</h2>
        <p class="mt-1">Two binary strings power this lock. Complete the table to prove you understand XOR across every column.</p>

        <div class="binary-meta mt-2" role="group" aria-label="Given binary values">
          <div class="meta-item">
            <h3>Binary A</h3>
            <code id="binaryA">101110</code>
          </div>
          <div class="meta-item">
            <h3>Binary B</h3>
            <code id="binaryB">100111</code>
          </div>
        </div>

        <table id="binaryInputTable" class="binary-table binary-input-table mt-2" aria-describedby="binaryHint"></table>

        <p id="binaryHint" class="muted mt-1">Tip: XOR outputs 1 where the bits differ and 0 where they match. Use the XOR row to mark those differences before converting to decimal.</p>
        <p class="muted mt-1">Enter 0 or 1 in every XOR column before you attempt the check.</p>

        <div class="binary-status mt-2" aria-live="polite">
          <span class="status-pill" id="valueAStatus">Decimal A pending</span>
          <span class="status-pill" id="valueBStatus">Decimal B pending</span>
          <span class="status-pill" id="xorStatus">XOR pending</span>
        </div>

        <div class="binary-result-grid mt-2">
          <label class="result-field" for="decAInput">
            <span>Binary A in decimal</span>
            <input id="decAInput" name="decAInput" type="number" inputmode="numeric" autocomplete="off" placeholder="?" aria-label="Decimal value of Binary A" />
          </label>
          <label class="result-field" for="decBInput">
            <span>Binary B in decimal</span>
            <input id="decBInput" name="decBInput" type="number" inputmode="numeric" autocomplete="off" placeholder="?" aria-label="Decimal value of Binary B" />
          </label>
          <label class="result-field" for="xorDec">
            <span>Decimal XOR (vault digit)</span>
            <input id="xorDec" name="xorDec" type="number" inputmode="numeric" autocomplete="off" placeholder="?" aria-label="Decimal XOR of A and B" />
          </label>
        </div>

        <div class="flex mt-2" style="gap:.75rem; flex-wrap:wrap;">
          <button class="btn" type="button" id="binaryCheck" data-tooltip="Check your entries">Check answers</button>
          <button class="btn ghost" type="button" id="binaryReset" data-tooltip="Clear inputs">Reset</button>
          <button class="btn ghost" type="button" id="binaryHintBtn">Hint (−5 pts)</button>
        </div>

        <p class="feedback mt-2" id="binaryFeedback" aria-live="polite"></p>
        <p class="muted mt-1" id="binaryChestHint" hidden>Your vault digit equals the decimal XOR result.</p>
        <p id="binaryHintText" class="hint-callout" hidden>Hints reveal which column values add together—use sparingly.</p>
      </section>

      <section class="card binary-xor" aria-labelledby="xorHeading">
        <h2 id="xorHeading">Why XOR Matters</h2>
        <p class="mt-1">XOR flags every column where the two binaries disagree.</p>
        <ul class="mt-1">
          <li>1 means the bits differ (keep that column); 0 means they match (drop it).</li>
          <li>The remaining columns add together to produce your vault digit.</li>
        </ul>
        <p class="mt-1">Confirm each decimal row, then bank the XOR total.</p>

        <div class="binary-coach" aria-labelledby="binaryCoachHeading">
          <h3 id="binaryCoachHeading">Binary Coach</h3>
          <ol>
            <li>Add the green columns in Binary A and Binary B to prove the decimal values.</li>
            <li>Mark only the mismatched columns for XOR—their sum is the vault digit.</li>
          </ol>
          <p>Grey columns are safe to ignore. Keep focusing on the highlighted ones.</p>
        </div>
      </section>
    </section>

    <section class="card resources-card mt-2" aria-labelledby="binaryResourcesHeading">
      <h2 id="binaryResourcesHeading">Further learning</h2>
      <ul>
        <li><a href="https://www.khanacademy.org/computing/computer-science/cryptography/ciphers/a/binary-number-system" target="_blank" rel="noopener">Khan Academy — Binary number system</a></li>
        <li><a href="https://www.csfieldguide.org.nz/en/chapters/representing-data/binary-numbers/" target="_blank" rel="noopener">CS Field Guide — Binary numbers</a></li>
        <li><a href="https://www.geeksforgeeks.org/binary-multiplication/" target="_blank" rel="noopener">GeeksforGeeks — Binary multiplication</a></li>
      </ul>
    </section>

    <nav class="challenge-nav" aria-label="Puzzle navigation">
      <a class="btn ghost" href="essential.html">&larr; Previous: ASD Essentials</a>
      <a class="btn" href="game.html">Next: Mission Hub &rarr;</a>
    </nav>
  </main>

  <div class="onboard" id="onboard-binary" hidden data-onboard-key="binary" data-onboard-auto="true" aria-labelledby="onboardBinaryTitle">
    <div class="onboard__backdrop" data-onboard-close></div>
    <div class="onboard__dialog">
      <button class="onboard__close" type="button" aria-label="Close tutorial" data-onboard-close>&times;</button>
      <h2 id="onboardBinaryTitle" data-onboard-focus>Binary Lab — Quick Guide</h2>
      <p>The vault digit is the decimal XOR value once your conversions are correct.</p>
      <ol class="onboard__list">
        <li>Read the table and add the highlighted (green) columns to get the decimal totals for Binary A and Binary B.</li>
        <li>Keep only the columns that differ to calculate the XOR decimal value.</li>
        <li>Press Check - when all three pills glow green, record the XOR decimal for the vault.</li>
      </ol>
    </div>
  </div>

  <!-- Global Footer -->
  <footer class="site-footer header-bleed">
    <div class="footer-inner">
      <nav class="footer-nav" aria-label="Footer">
        <a href="index.html">Home</a>
        <span aria-hidden="true">•</span>
        <a href="game.html">Mission Hub</a>
        <span aria-hidden="true">•</span>
      </nav>
      <p class="footer-note">Convert both binaries, crush the XOR, and the vault digit reveals itself.</p>
      <p class="footer-copy"><small>&copy; 2025 Cyber Escape Rooms</small></p>
    </div>
  </footer>
</body>
</html>
