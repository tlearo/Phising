<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Decrypt the message using a Caesar wheel. Earn your digit for the final vault lock in Cyber Escape Rooms." />
  <link rel="icon" href="assets/favicon.png" type="image/png" />

  <!-- Tight CSP (local assets only) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self';
                 connect-src 'self';
                 object-src 'none';
                 base-uri 'self';
                 frame-ancestors 'none'">

  <title>Cyber Escape Rooms — Encryption</title>

  <!-- External files only -->
  <link rel="stylesheet" href="css/styles.css" />
  <script src="js/accessibility.js" defer></script>
  <script src="js/utils.js" defer></script>
  <script src="js/state-sync.js" defer></script>
  <script src="js/session.js" defer></script>
  <script src="js/vault.js" defer></script>
  <script src="js/onboarding.js" defer></script>
  <script src="js/caesar.js" defer></script>
  <script src="js/encryption.js" defer></script>
</head>

<body data-session="team">
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Global Header -->
  <header class="site-header site-header--bar" aria-label="Global">
    <div class="site-header__inner">
      <div class="header-left">
        <button class="nav-btn ghost nav-btn--back" type="button" data-back="game.html" data-tooltip="Back to previous page">
          <span aria-hidden="true">←</span>
          <span>Back</span>
        </button>
        <a class="brand" href="game.html">
          <img src="assets/logo.png" alt="" class="logo" />
          <span class="brand-copy">
            <span class="brand-name">Cyber Escape Rooms</span>
            <span class="brand-tagline">Team-based security missions</span>
          </span>
        </a>
      </div>

      <div class="header-actions">
        <nav class="main-nav" aria-label="Primary">
          <a class="nav-link" href="game.html">Mission Hub</a>
          <a class="nav-link" href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
        </nav>
        <a class="nav-btn nav-btn--next" href="essential.html" aria-label="Next challenge: Essential Eight">
          Next<span aria-hidden="true">→</span>
        </a>
        <div class="vault-status" id="vaultStatus" role="status" aria-live="polite" data-visible="team">
          <span class="vault-status__label">Vault</span>
          <ol class="vault-status__digits">
            <li data-vault-key="phishing">•</li>
            <li data-vault-key="encryption">•</li>
            <li data-vault-key="password">•</li>
            <li data-vault-key="essential">•</li>
            <li data-vault-key="binary">•</li>
          </ol>
          <span class="vault-status__count">0/5</span>
        </div>
        <button class="nav-btn alert nav-btn--logout" type="button" data-action="logout">Logout</button>
      </div>
    </div>
  </header>

  <main class="container" id="main" role="main" tabindex="-1">
    <header class="game-header">
      <h1 class="glow">Encryption</h1>
      <p class="mt-1" style="color:var(--muted)">Use the Caesar wheel to decode the message. Submit the plaintext to earn your digit.</p>
      <div class="puzzle-actions mt-1">
        <button class="btn ghost sm onboard-trigger" type="button" data-onboard="onboard-encryption">How to play</button>
      </div>
    </header>

    <section class="intro-banner points-card mt-2" aria-labelledby="encryptionPointsHeading">
      <details class="points-panel" open>
        <summary id="encryptionPointsHeading">Points intel</summary>
        <p>Precise decrypts keep your score intact. Work the Caesar wheel with intent, verify the plaintext, and log the shift without spamming guesses.</p>
        <ul>
          <li>Hints cost 5 points, so save them for when the ciphertext truly stalls.</li>
          <li>Submit only once the plaintext reads naturally; repeated wrong answers signal rushed work.</li>
          <li>The shift number becomes your vault digit—write it down as soon as you receive confirmation.</li>
        </ul>
      </details>
      <div class="vault-callout" role="status">
        <span class="tag">Vault digit</span>
        <p>The shift value will appear here after you submit the correct plaintext: <strong id="encVaultValue">—</strong>.</p>
      </div>
    </section>

    <aside class="card tip-card mt-2" aria-labelledby="encryptionTipHeading">
      <h2 id="encryptionTipHeading">Mission tip</h2>
      <p class="muted">Use the preview area to confirm the plaintext before submitting. The correct shift value becomes your vault digit—write it down the moment the message reads clearly.</p>
    </aside>

    <section class="status-hud" aria-label="Team status">
      <div class="points-box">
        <p class="points-box__label">Team points</p>
        <p class="points-box__value" id="encryptionPointsTotal">000</p>
        <p class="points-box__delta" id="encryptionPointsDelta" aria-live="polite"></p>
      </div>
      <div class="progress-mini">
        <p class="progress-mini__label">Puzzle progress</p>
        <div class="progress-mini__track">
          <div class="progress-mini__fill" id="encryptionProgressFill"></div>
        </div>
        <p class="progress-mini__text" id="encryptionProgressText">0% complete</p>
      </div>
    </section>

    <!-- Two-column responsive layout -->
    <section class="enc-layout mt-2">
      <!-- LEFT: Wheel & controls -->
      <aside class="enc-wheel-panel card" aria-label="Caesar wheel controls">
        <!-- Fixed-size wheel viewport -->
        <div id="wheelWrap" class="wheel-wrap">
          <!-- OUTER: plaintext A–Z (upright) -->
          <div id="outerRing" class="wheel outer" aria-hidden="true"></div>
          <!-- INNER: cipher a–z (rotates) -->
          <div id="innerRing" class="wheel inner"
               role="slider" aria-label="Shift amount"
               aria-valuemin="0" aria-valuemax="25" aria-valuenow="0"
               tabindex="0"></div>
        </div>

        <div class="flex" aria-label="Shift controls">
          <button id="shiftDown" class="btn sm" type="button" aria-label="Decrease shift">−</button>
          <input id="shiftSlider" type="range" min="0" max="25" value="0" aria-label="Shift slider" />
          <button id="shiftUp" class="btn sm" type="button" aria-label="Increase shift">+</button>
          <span class="shift-readout" aria-live="polite">Shift: <strong id="shiftValue">0</strong><small>vault digit</small></span>
        </div>
        <p class="muted enc-note">Outer ring = cipher text (what you read). Inner ring = plaintext (rotate until it looks right).</p>
        <div class="enc-example mt-1">
          <p>Example mapping:</p>
          <p><span class="tag">Cipher</span> <span id="encExampleCipher">A</span> → <span class="tag">Plain</span> <span id="encExamplePlain">A</span></p>
        </div>
      </aside>

      <!-- RIGHT: Cipher, live output, submit -->
      <section class="enc-panel card" aria-label="Decryption workspace">
        <h2>Decrypt This</h2>

        <p id="encHintText" class="hint-callout" hidden>
          Rotate the inner ring until common words line up beneath their cipher letters. When everything reads clearly, record that shift.
        </p>

        <div class="mt-1">
          <p class="muted">Ciphertext:</p>
          <div class="card sm mt-1" style="overflow:auto">
            <code id="cipherText">—</code>
          </div>
        </div>

        <div class="mt-2" id="livePreviewBlock">
          <p class="muted">Live plaintext preview:</p>
          <div class="card sm mt-1 hint-locked" id="livePreviewLocked" role="note">
            Use the hint (−5 pts) to unlock the live preview.
          </div>
          <div class="card sm mt-1" id="livePreviewCard" style="overflow:auto" hidden>
            <code id="livePlaintext">Rotate the wheel to decode...</code>
          </div>
        </div>

        <div class="mt-2 field">
          <label for="finalAnswer">Type the final plaintext (exact spelling):</label>
          <input id="finalAnswer" type="text" autocomplete="off" />
        </div>

        <div class="flex mt-2">
          <button id="submitBtn" class="btn" type="button" data-tooltip="Submit decoded plaintext">Submit</button>
          <button class="btn ghost" id="encHintBtn" type="button">Hint (−5 pts)</button>
          <a href="game.html" class="btn ghost">Back to Vault</a>
          <a href="index.html" class="btn">Home</a>
        </div>

        <p id="encFeedback" class="mt-2" aria-live="polite"></p>
      </section>
    </section>

    <section class="card resources-card mt-2" aria-labelledby="encryptionResourcesHeading">
      <h2 id="encryptionResourcesHeading">Further learning</h2>
      <ul>
        <li><a href="https://www.khanacademy.org/computing/computer-science/cryptography" target="_blank" rel="noopener">Khan Academy — Cryptography</a></li>
        <li><a href="https://www.nsa.gov/visit/cryptologic-heritage/what-we-do/cryptanalysis/caesar-shift/" target="_blank" rel="noopener">NSA — Caesar shift background</a></li>
        <li><a href="https://www.crypto101.io/" target="_blank" rel="noopener">Crypto 101 (free book)</a></li>
      </ul>
    </section>

    <nav class="challenge-nav" aria-label="Puzzle navigation">
      <a class="btn ghost" href="password.html">&larr; Previous: Password Puzzle</a>
      <a class="btn" href="essential.html">Next: Essential Eight &rarr;</a>
    </nav>

    <footer class="mt-3">
      <p style="color:var(--muted)">Tip: the inner ring rotates; align letters to reveal the plaintext.</p>
    </footer>
  </main>

  <div class="onboard" id="onboard-encryption" hidden data-onboard-key="encryption" data-onboard-auto="true" aria-labelledby="onboardEncryptionTitle">
    <div class="onboard__backdrop" data-onboard-close></div>
    <div class="onboard__dialog">
      <button class="onboard__close" type="button" aria-label="Close tutorial" data-onboard-close>&times;</button>
      <h2 id="onboardEncryptionTitle" data-onboard-focus>Encryption — Quick Guide</h2>
      <p>Digit two equals the shift that uncovers the plaintext message.</p>
      <ol class="onboard__list">
        <li>Drag the inner ring or use the slider until the ciphertext forms natural language.</li>
        <li>Watch the live output area to confirm the plaintext before you submit.</li>
        <li>Submit the decoded phrase and record the displayed shift as your vault digit.</li>
      </ol>
    </div>
  </div>

  <!-- Global Footer -->
  <footer class="site-footer header-bleed">
    <div class="footer-inner">
      <nav class="footer-nav" aria-label="Footer">
        <a href="index.html">Home</a>
        <span aria-hidden="true">•</span>
        <a href="game.html">Mission Hub</a>
        <span aria-hidden="true">•</span>
        <a href="admin.html" data-role="admin-link" data-visible="admin" hidden aria-hidden="true">Admin</a>
      </nav>
      <p class="footer-note">Turn the Caesar wheel, decode the message, and earn your cipher digit.</p>
      <p class="footer-copy"><small>&copy; 2025 Cyber Escape Rooms</small></p>
    </div>
  </footer>
</body>
</html>
