<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Strength Tester</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      margin: 0;
      padding: 1rem;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
      background: transparent;
      color: var(--ink);
    }
    .tester {
      display: grid;
      gap: 1rem;
    }
    .tester input[type="text"],
    .tester input[type="password"] {
      width: 100%;
      padding: .75rem .85rem;
      border-radius: 10px;
      border: 1px solid rgba(88,166,255,.35);
      background: rgba(9, 14, 22, .8);
      color: #fff;
      font-size: 1rem;
    }
    .tester input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 4px rgba(88,166,255,.2);
    }
    .meter-track {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: rgba(88,166,255,.16);
      overflow: hidden;
    }
    .meter-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, rgba(255,94,94,.85), rgba(9,255,136,.85));
      transition: width .25s ease;
    }
    .stats {
      display: grid;
      gap: .5rem;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .95rem;
      background: rgba(9, 14, 22, .7);
      border: 1px solid rgba(88,166,255,.18);
      border-radius: 10px;
      padding: .65rem .85rem;
    }
    .stat-row strong {
      font-family: "JetBrains Mono", Consolas, monospace;
      color: #fff;
      font-size: 1.05rem;
      letter-spacing: .02em;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      padding: .25rem .6rem;
      border-radius: 999px;
      font-size: .75rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      background: rgba(88,166,255,.14);
      color: var(--brand);
    }
    .tag.good {
      background: rgba(9,255,136,.18);
      color: var(--accent);
    }
    .suggestions {
      display: grid;
      gap: .4rem;
      padding-left: 1.1rem;
      color: var(--muted);
    }
    .suggestions li {
      line-height: 1.45;
    }
  </style>
</head>
<body>
  <div class="tester" aria-live="polite">
    <div>
      <label for="pwTesterInput" class="tag">Password strength tester</label>
      <input id="pwTesterInput" type="text" autocomplete="off" placeholder="Type a password to evaluate" aria-describedby="pwTesterDesc" />
      <p id="pwTesterDesc" style="color:var(--muted); margin-top:.4rem;">The analysis stays on this machine—no passwords are sent anywhere.</p>
    </div>

    <div>
      <div class="meter-track" role="presentation">
        <div id="pwTesterMeter" class="meter-fill"></div>
      </div>
      <p id="pwTesterLabel" style="margin-top:.45rem; color:var(--muted);">Waiting for input…</p>
    </div>

    <div class="stats">
      <div class="stat-row">
        <span>Estimated crack time</span>
        <strong id="pwTesterCrack">—</strong>
      </div>
      <div class="stat-row">
        <span>Rounded minutes (vault digit)</span>
        <strong id="pwTesterDigit">—</strong>
      </div>
      <div class="stat-row">
        <span>Detected pattern</span>
        <strong id="pwTesterPattern">—</strong>
      </div>
    </div>

    <div>
      <p class="tag" style="margin-bottom:.35rem;">Suggestions</p>
      <ul id="pwTesterAdvice" class="suggestions">
        <li>Enter a password to analyse it.</li>
      </ul>
    </div>
  </div>

  <script src="../js/password-strength.js"></script>
  <script>
    (function () {
      const Strength = window.PasswordStrength;
      if (!Strength) return;

      const input = document.getElementById('pwTesterInput');
      const meter = document.getElementById('pwTesterMeter');
      const label = document.getElementById('pwTesterLabel');
      const crack = document.getElementById('pwTesterCrack');
      const digit = document.getElementById('pwTesterDigit');
      const pattern = document.getElementById('pwTesterPattern');
      const adviceList = document.getElementById('pwTesterAdvice');

      const LABELS = [
        'Instantly cracked — add length and variety.',
        'Minutes to crack — still risky.',
        'Hours to crack — add more randomness.',
        'Days to crack — consider a longer passphrase.',
        'Years to crack — strong!'
      ];

      function renderSuggestions(items) {
        adviceList.innerHTML = '';
        items.forEach(text => {
          const li = document.createElement('li');
          li.textContent = text;
          adviceList.appendChild(li);
        });
      }

      function update(value) {
        const analysis = Strength.analyze(value);
        const percent = Math.min(100, Math.max(10, analysis.scale * 10));
        meter.style.width = `${percent}%`;
        meter.style.background = analysis.score >= 3
          ? 'linear-gradient(90deg, rgba(9,255,136,.4), rgba(9,255,136,.85))'
          : 'linear-gradient(90deg, rgba(255,94,94,.75), rgba(255,174,0,.85))';

        label.textContent = LABELS[analysis.score] || 'Analysed.';
        crack.textContent = analysis.crackTime;
        const minutes = Math.max(1, Math.round(analysis.seconds / 60));
        const suffix = !Number.isFinite(minutes) || minutes >= 10 ? '+' : '';
        digit.textContent = `${analysis.digit}${suffix}`;
        const patternText = analysis.method && analysis.method !== 'empty' ? analysis.method : '—';
        pattern.textContent = patternText;
        renderSuggestions(analysis.suggestions);
      }

      input.addEventListener('input', () => update(input.value.trim()));
      update('');

      window.addEventListener('message', (event) => {
        if (!event?.data) return;
        try {
          const payload = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
          if (payload?.type === 'password:test') {
            input.value = payload.value || '';
            update(input.value.trim());
          }
        } catch (_) {
          /* ignore malformed messages */
        }
      });
    })();
  </script>
</body>
</html>
